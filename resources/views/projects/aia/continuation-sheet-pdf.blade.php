<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<HTML>
<HEAD>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
<TITLE>{{ @$project->name }} </TITLE>
<META name="generator" content="BCL easyConverter SDK 5.0.252">
<STYLE type="text/css">

body {margin-top: 0px;margin-left: 0px;}

#page_1 {    
    position: relative;
    margin: -15px auto;
    padding: 0px;
    border: none;
    width: 1056px;
    height: 731px;
  }

#page_1 #id1_1 {
    float: left;
    border: none;
    padding: 0px;
    border: none;
    width: 641px;
    overflow: hidden;
  }

#page_1 #id1_2 {    
    margin: 230px 0px 0px;
    padding: 0px;
    border: none;
    overflow: hidden;
  }

.dclr {clear:both;float:none;height:1px;margin:0px;padding:0px;overflow:hidden;}

.ft0{font: bold 23px 'Arial';line-height: 27px;}
.ft1{font: 15px 'Arial';line-height: 17px;}
.ft2{font: bold 20px 'Arial';line-height: 24px;}
.ft3{font: 18px 'Arial';line-height: 23px;}
.ft4{font: 18px 'Arial';line-height: 22px;}
.ft5{font: 1px 'Arial';line-height: 1px;}
.ft6{font: bold 24px 'Arial';line-height: 29px;}
.ft7{font: 13px 'Arial';line-height: 16px;}
.ft8{font: 12px 'Arial';line-height: 15px;}
.ft9{font: 11px 'Arial';line-height: 14px;}
.ft10{font: 1px 'Arial';line-height: 15px;}
.ft11{font: 13px 'Arial';line-height: 15px;}
.ft12{font: 1px 'Arial';line-height: 7px;}
.ft13{font: 1px 'Arial';line-height: 8px;}
.ft14{font: 1px 'Arial';line-height: 9px;}
.ft15{font: bold 12px 'Arial';line-height: 15px;}
.ft23{font: bold 12px 'Arial';line-height: 15px;}
.ft21{font: bold 12px 'Arial';line-height: 15px;}

.p0{text-align: right;padding-right: 110px;margin-top: 0px;margin-bottom: 0px;}
.p1{text-align: left;padding-left: 20px;margin-top: 10px;margin-bottom: 0px;}
.p2{text-align: left;margin-top: 0px;margin-bottom: 0px;white-space: nowrap;}
.p3{text-align: left;padding-left: 7px;margin-top: 0px;margin-bottom: 0px;white-space: nowrap;}
.p4{text-align: left;padding-left: 4px;margin-top: 0px;margin-bottom: 0px;white-space: nowrap;}
.p5{text-align: center;padding-right: 2px;margin-top: 0px;margin-bottom: 0px;white-space: nowrap;}
.p6{text-align: left;padding-left: 29px;margin-top: 0px;margin-bottom: 0px;white-space: nowrap;}
.p7{text-align: center;padding-right: 13px;margin-top: 0px;margin-bottom: 0px;white-space: nowrap;}
.p8{text-align: center;padding-right: 18px;margin-top: 0px;margin-bottom: 0px;white-space: nowrap;}
.p9{text-align: center;padding-right: 16px;margin-top: 0px;margin-bottom: 0px;white-space: nowrap;}
.p10{text-align: left;padding-left: 60px;margin-top: 0px;margin-bottom: 0px;white-space: nowrap;}
.p11{text-align: center;padding-right: 4px;margin-top: 0px;margin-bottom: 0px;white-space: nowrap;}
.p12{text-align: center;padding-right: 1px;margin-top: 0px;margin-bottom: 0px;white-space: nowrap;}
.p13{text-align: left;padding-left: 35px;margin-top: 0px;margin-bottom: 0px;white-space: nowrap;}
.p14{text-align: center;padding-right: ;margin-top: 0px;margin-bottom: 0px;white-space: nowrap;}
.p15{text-align: center;padding-right: 12px;margin-top: 0px;margin-bottom: 0px;white-space: nowrap;}
.p16{text-align: center;padding-right: 17px;margin-top: 0px;margin-bottom: 0px;white-space: nowrap;}
.p17{text-align: center;padding-right: 10px;margin-top: 0px;margin-bottom: 0px;white-space: nowrap;}
.p18{text-align: center;padding-left: 3px;margin-top: 0px;margin-bottom: 0px;white-space: nowrap;}
.p19{text-align: center;padding-right: 14px;margin-top: 0px;margin-bottom: 0px;white-space: nowrap;}
.p20{text-align: center;padding-right: 43px;margin-top: 0px;margin-bottom: 0px;white-space: nowrap;}
.p21{text-align: left;padding-left: 20px;margin-top: 0px;margin-bottom: 0px;white-space: nowrap;}
.p22{text-align: left;padding-left: 27px;margin-top: 0px;margin-bottom: 0px;white-space: nowrap;}

.td0{padding: 0px;margin: 0px;width: 200px;vertical-align: bottom;}
.td1{padding: 0px;margin: 0px;width: 175px;vertical-align: bottom;}
.td2{padding: 0px;margin: 0px;width: 332px;}
.td3{padding: 0px;margin: 0px;width: 222px;vertical-align: bottom;}
.td4{padding: 0px;margin: 0px;width: 43px;vertical-align: middle;}
.td5{padding: 0px;margin: 0px;width: 194px;vertical-align: middle;}
.td6{padding: 0px;margin: 0px;width: 103px;vertical-align: middle;}
.td7{padding: 0px;margin: 0px;width: 104px;vertical-align: middle;}
.td8{padding: 0px;margin: 0px;width: 96px;vertical-align: middle;}
.td9{padding: 0px;margin: 0px;width: 97px;vertical-align: middle;}
.td10{padding: 0px;margin: 0px;width: 91px;vertical-align: middle;}
.td11{padding: 0px;margin: 0px;width: 56px;vertical-align: middle;}
.td12{padding: 0px;margin: 0px;width: 95px;vertical-align: middle;}
.td13{padding: 0px;margin: 0px;width: 200px;vertical-align: middle;}
.td14{padding: 0px;margin: 0px;width: 497px;vertical-align: middle;}
.td22{padding: 0px;margin: 0px;width: 196px;vertical-align: bottom;}
.td23{padding: 0px;margin: 0px;width: 165px;vertical-align: bottom;}

.tr0{height: 30px;}
.tr1{height: 24px;}
.tr2{height: 26px;}
.tr3{height: 34px;}

.tr4{height: 23px;}
.tr5{height: 22px;}
.tr6{height: 15px;}
.tr7{height: 7px;}
.tr8{height: 8px;}
.tr9{height: 16px;}
.tr10{height: 17px;}
.tr11{height: 9px;}
.tr12{height: 24px;}
.tr13{height: 24px;}
.tr14{height: 62px;}
.tr15{height: 25px;}
.tr18{height: 20px;}
.tr19{height: 30px;background: #ededed;}
.tr20{height: 31px;}
.tr-grey{
  background: #ededed;
}

.t0{
  width:  590px;
  margin-left: -1px;
  margin-top: 10px;
  font: bold 20px 'Arial';
  border: 4px solid #17aecf;
}

/*.t1{
  width: 550px;
  margin-left: 1px;
  margin-top: -7px;
  font: 16px 'Arial';
}

.t2{width: 430px;font: 13px 'Arial';}
*/
.t3{font: 16px 'Arial';}

.left1{
  border: 4px solid #17aecf;
  width: 580px;
  padding: 10px 0px;
  position: relative;
}

.right1{
    float: left;
    border: 4px solid #17aecf;
    width: 350px;
    padding-left: 10px;
    margin-bottom: 12px;
}

.table1 td{
    padding: 0px 5px;
}

.table2 td.bwr{
    border: 2px solid;
    border-right: none;
}

.table2 td.bwl{
    border: 2px solid;
    border-left: none;
}

.table2 td.btb{
    border: 2px solid;
    border-left: none;
    border-right: none;
}

.table2 td.bl{
    border-left:2px solid;
}

.table2 td.blt{
    border-left:2px solid;
     border-top:2px solid;
}
.table2 td.blb{
    border-left:2px solid;
    border-bottom:2px solid;
}

.table2 td.br{
    border-right:2px solid;
}

.table2 td.brt{
    border-right:2px solid;
    border-top:2px solid;
}

.table2 td.brl{
    border-right:2px solid;
    border-bottom:2px solid;
}    

.table2 td.bt{
    border-top:2px solid;
}
.table2 td.bb{
    border-bottom:2px solid;
}
.table2 tr{
  width: 400px;
}

.left1 img{
  width: 120px;
  position: absolute;
  /*height: 40px;*/
  top: 5px;
  left: 20px;
}
.left1 .ft1{
  font-size: 12px;
}


footer {
  position: fixed; 
  bottom:0px;
  text-align: right;
  font-size: 12px;
}

header {
    position: fixed;
    top: 0px;
    left: 0px;
    right: 0px;
    height: 50px;
    text-align: center;
    line-height: 35px;
    /*display: none;*/
}

.pagenum:before {
      content: counter(page);
}
.lb{
    border-left: 1px solid !important;
}

.lrb{
    border-left: 1px solid !important;
    border-right: 1px solid !important;
}

.lr{
    border-right: 1px solid !important;
}
.bb{
    border-bottom: 1px solid !important;
}
.pbb{
    padding-top: 7px;
    border-bottom: 1px solid !important;

}
.pbb span{
    margin-bottom: 7px;
    display: inline-block;
    margin-left: 25px;
}
.pbb2{
    padding-top: 7px;
    border-bottom: 1px solid !important;
}
.pbb2 span{
    margin-bottom: 7px;
    display: inline-block;
    margin-left: 25px;
}
.bub{
    border-bottom: 1px solid !important;
    border-top: 1px solid !important;
}
.brn{
    border-right: none !important;
}

.blrn{
    border-left: 1px solid !important;
    border-right: none !important;
}

.t3 td.tr4{
border: 1px solid;
border-bottom: none;
border-left: none;
}

.t4 td.tr19{
border: 1px solid;
border-bottom: none;
border-left: none;
}
.t4 td.tr20{
border: 1px solid;
border-bottom: none;
border-left: none;
}
.t3 td.tr5{
border: 1px solid;
border-bottom: none;
border-left: none;
}
.t3 td.tr1{border-top: 1px solid;
border-right: 1px solid;
}

.t3 td.tr13{
border-top: 1px solid;
border-right: 1px solid;
}

.star{
  color: red;
}

p.p23 {
    padding-left: 6px;
    margin-top: 0px;
    line-height: 8px;
}

p.p24 {
    padding-left: 6px;
    margin-top: 0px;
    line-height: 8px;
    margin-bottom: 10px;
    width: 200px;
}
p.p32  {
    padding-right: 6px;
    margin-top: 0px;
    line-height: 8px;
    margin-bottom: 0px;
    text-align: right;
}

.t4{width: 470px;font: 13px 'Arial';margin-top: 20px;}
.t5{width: 351px;font: 20px 'Arial';}


</STYLE>
</HEAD>

<BODY>

  <footer>
      {{ \Carbon\Carbon::now()->format('m-d-Y') }} - Page <span class="pagenum"></span>
  </footer>

  <header> 
      <div style="float: left; width: 63%; margin-bottom: 10px;">
      <div class="left1">
        <img src="data:image/jpg;base64,{{ base64_encode(file_get_contents(public_path('img/invoice-logo.jpg'))) }}">
         <P class="p0 ft0">Continuation Sheet</P>
         <P class="p1 ft1"> QPMCONSTRUCTION </P>

      </div>

       <TABLE cellpadding=0 cellspacing=0 class="t0 table1">
        <TR>
          <TD class="tr0 td0"><P class="p2 ft2">Project Name</P></TD>
          <TD class="tr0 td1"><P class="p2 ft3">{{ @$project->name }}</P></TD>
        </TR>
        <TR>
          <TD class="tr1 td0"><P class="p2 ft2">Project #</P></TD>
          <TD class="tr1 td1"><P class="p2 ft4">{{ @$project->project_number }}</P></TD>
        </TR>
        <TR>
          <TD class="tr2 td0" style="padding-bottom:5px;"><P class="p2 ft2">Subcontractor Name</P></TD>
          <TD class="tr2 td1"><P class="p2 ft5">&nbsp;</P></TD>
        </TR>
        </TABLE>
    </div>

    <div class="right1">
      <TABLE cellpadding=0 cellspacing=0 class="t2">
      <TR>
        <TD class="tr0 td22"><P class="p2 ft2">Application #</P></TD>
        <TD class="tr0 td23"><P class="p8 ft3" style="text-align:left;">{{ @$applicationsCount }}</P></TD>
      </TR>
      <TR>
        <TD class="tr10 td22"><P class="p2 ft2">Application Date</P></TD>
        <TD class="tr10 td23"><P class="p8 ft3" style="text-align:left;">{{ \Carbon\Carbon::parse(@$application->application_date)->format('m/d/Y')}}</P></TD>
      </TR>
      <TR>
        <TD class="tr12 td22"><P class="p2 ft2">Period To</P></TD>
        <TD class="tr12 td23"><P class="p8 ft3" style="text-align:left;">{{ \Carbon\Carbon::parse(@$application->period_to)->format('m/d/Y')}}</P></TD>
      </TR>
      </TABLE>
    </div>

</header>

<DIV id="page_1">

<div>

<!-- <div class="id1_1">
  
</div> -->

<DIV id="id1_2">

<TABLE cellpadding=0 cellspacing=0 class="t3">
<TR>
  <TD class="lb tr4 td4"><P class="p5 ft7">A</P></TD>
  <TD class="tr4 td5"><P class="p6 ft8">B</P></TD>
  <TD class="tr4 td6"><P class="p5 ft7">C</P></TD>
  <TD class="tr4 td7"><P class="p7 ft7">D</P></TD>
  <TD class="tr4 td8"><P class="p8 ft8">E</P></TD>
  <TD class="tr4 td9"><P class="p9 ft8">F</P></TD>
  <TD class="tr4 td10"><P class="p10 ft7">G</P></TD>
  <TD class="tr4 td11"><P class="p2 ft6">&nbsp;</P></TD>
  <TD class="tr4 td10"><P class="p7 ft7">H</P></TD>
  <TD class="tr4 td12"><P class="p11 ft7">I</P></TD>
</TR>
<TR>
  <TD class="lb tr5 td4"><P class="p12 ft7">ITEM #</P></TD>
  <TD class="tr5 td5"><P class="p6 ft8">DESCRIPTION OF WORK</P></TD>
  <TD class="tr5 td6"><P class="p5 ft9">SCHEDULED</P></TD>
  <TD colspan=2 class="tr5 td13"><P class="p13 ft7">WORK COMPLETED</P></TD>
  <TD class="tr5 td9"><P class="p9 ft8">MATERIALS</P></TD>
  <TD class="tr5 td10"><P class="p14 ft7">TOTAL</P></TD>
  <TD class="tr5 td11"><P class="p15 ft9">%</P></TD>
  <TD class="tr5 td10"><P class="p15 ft8">BALANCE TO</P></TD>
  <TD class="tr5 td12"><P class="p11 ft8">RETAINAGE</P></TD>
</TR>
<TR>
  <TD class="lrb tr6 td4"><P class="p2 ft10">&nbsp;</P></TD>
  <TD class="lr tr6 td5"><P class="p2 ft10">&nbsp;</P></TD>
  <TD class="lr tr6 td6"><P class="p5 ft8">VALUE</P></TD>
  <TD rowspan=2 class="lr tr5 td7"><P class="p7 ft8">FROM</P></TD>
  <TD rowspan=2 class="lr tr5 td8"><P class="p8 ft8">THIS PERIOD</P></TD>
  <TD class="lr tr6 td9"><P class="p16 ft9">PRESENTLY</P></TD>
  <TD class="lr tr6 td10"><P class="p17 ft8">COMPLETED</P></TD>
  <TD class="lr tr6 td11"><P class="p18 ft11">(G / C)</P></TD>
  <TD class="lr tr6 td10"><P class="p7 ft11">FINISH</P></TD>
  <TD class="lr tr6 td12"><P class="p11 ft11">(G x Retainage)</P></TD>
</TR>
<TR>
  <TD class="lrb tr7 td4"><P class="p2 ft12">&nbsp;</P></TD>
  <TD class="lr tr7 td5"><P class="p2 ft12">&nbsp;</P></TD>
  <TD class="lr tr7 td6"><P class="p2 ft12">&nbsp;</P></TD>
  <TD rowspan=2 class="lr tr6 td9"><P class="p9 ft9">STORED</P></TD>
  <TD rowspan=2 class="lr tr6 td10"><P class="p17 ft8">AND STORED</P></TD>
  <TD class="lr tr7 td11"><P class="p2 ft12">&nbsp;</P></TD>
  <TD rowspan=2 class="lr tr6 td10"><P class="p15 ft8">EXCLUDING</P></TD>
  <TD class="lr tr7 td12"><P class="p2 ft12">&nbsp;</P></TD>
</TR>
<TR>
  <TD class="lrb tr8 td4"><P class="p2 ft13">&nbsp;</P></TD>
  <TD class="lr tr8 td5"><P class="p2 ft13">&nbsp;</P></TD>
  <TD class="lr tr8 td6"><P class="p2 ft13">&nbsp;</P></TD>
  <TD rowspan=2 class="lr tr9 td7"><P class="p19 ft8">PREVIOUS</P></TD>
  <TD class="lr tr8 td8"><P class="p2 ft13">&nbsp;</P></TD>
  <TD class="lr tr8 td11"><P class="p2 ft13">&nbsp;</P></TD>
  <TD class="lr tr8 td12"><P class="p2 ft13">&nbsp;</P></TD>
</TR>
<TR>
  <TD class="lrb tr8 td4"><P class="p2 ft13">&nbsp;</P></TD>
  <TD class="lr tr8 td5"><P class="p2 ft13">&nbsp;</P></TD>
  <TD class="lr tr8 td6"><P class="p2 ft13">&nbsp;</P></TD>
  <TD class="lr tr8 td8"><P class="p2 ft13">&nbsp;</P></TD>
  <TD rowspan=2 class="lr tr9 td9"><P class="p9 ft7">(not in D or E)</P></TD>
  <TD rowspan=2 class="lr tr9 td10"><P class="p17 ft8">TO DATE</P></TD>
  <TD class="lr tr8 td11"><P class="p2 ft13">&nbsp;</P></TD>
  <TD rowspan=2 class="lr tr9 td10"><P class="p7 ft8">RETAINAGE</P></TD>
  <TD class="lr tr8 td12"><P class="p2 ft13">&nbsp;</P></TD>
</TR>
<TR>
  <TD class="lrb tr8 td4"><P class="p2 ft13">&nbsp;</P></TD>
  <TD class="lr tr8 td5"><P class="p2 ft13">&nbsp;</P></TD>
  <TD class="lr tr8 td6"><P class="p2 ft13">&nbsp;</P></TD>
  <TD rowspan=2 class="lr tr9 td7"><P class="p7 ft8">APPLICATIONS</P></TD>
  <TD class="lr tr8 td8"><P class="p2 ft13">&nbsp;</P></TD>
  <TD class="lr tr8 td11"><P class="p2 ft13">&nbsp;</P></TD>
  <TD class="lr tr8 td12"><P class="p2 ft13">&nbsp;</P></TD>
</TR>
<TR>
  <TD class="lrb tr8 td4"><P class="p2 ft13">&nbsp;</P></TD>
  <TD class="lr tr8 td5"><P class="p2 ft13">&nbsp;</P></TD>
  <TD class="lr tr8 td6"><P class="p2 ft13">&nbsp;</P></TD>
  <TD class="lr tr8 td8"><P class="p2 ft13">&nbsp;</P></TD>
  <TD class="lr tr8 td9"><P class="p2 ft13">&nbsp;</P></TD>
  <TD rowspan=2 class="lr tr10 td10"><P class="p17 ft8">(D + E + F)</P></TD>
  <TD class="lr tr8 td11"><P class="p2 ft13">&nbsp;</P></TD>
  <TD class="lr tr8 td10"><P class="p2 ft13">&nbsp;</P></TD>
  <TD class="lr tr8 td12"><P class="p2 ft13">&nbsp;</P></TD>
</TR>
<TR>
  <TD class="lrb tr11 td4"><P class="p2 ft14">&nbsp;</P></TD>
  <TD class="lr tr11 td5"><P class="p2 ft14">&nbsp;</P></TD>
  <TD class="lr tr11 td6"><P class="p2 ft14">&nbsp;</P></TD>
  <TD rowspan=2 class="lr tr10 td7"><P class="p7 ft8">Column (D & E)</P></TD>
  <TD class="lr tr11 td8"><P class="p2 ft14">&nbsp;</P></TD>
  <TD class="lr tr11 td9"><P class="p2 ft14">&nbsp;</P></TD>
  <TD class="lr tr11 td11"><P class="p2 ft14">&nbsp;</P></TD>
  <TD class="lr tr11 td10"><P class="p2 ft14">&nbsp;</P></TD>
  <TD class="lr tr11 td12"><P class="p2 ft14">&nbsp;</P></TD>
</TR>
<TR>
  <TD class="lrb tr8 td4"><P class="p2 ft13">&nbsp;</P></TD>
  <TD class="lr tr8 td5"><P class="p2 ft13">&nbsp;</P></TD>
  <TD class="lr tr8 td6"><P class="p2 ft13">&nbsp;</P></TD>
  <TD class="lr tr8 td8"><P class="p2 ft13">&nbsp;</P></TD>
  <TD class="lr tr8 td9"><P class="p2 ft13">&nbsp;</P></TD>
  <TD class="lr tr8 td10"><P class="p2 ft13">&nbsp;</P></TD>
  <TD class="lr tr8 td11"><P class="p2 ft13">&nbsp;</P></TD>
  <TD class="lr tr8 td10"><P class="p2 ft13">&nbsp;</P></TD>
  <TD class="lr tr8 td12"><P class="p2 ft13">&nbsp;</P></TD>
</TR>
@php
 $codTotal = $coeTotal = $cofTotal = $cogTotal = $cohTotal = $coiTotal = 0;
 $dTotal = $eTotal = $fTotal = $gTotal = $hTotal = $iTotal = 0;
 $nmTotal = $pbTotal = 0;
 $conmTotal = $copbTotal = 0;
 $total_percentage = 0;
 $co_less_retainage = 0;
@endphp
@foreach(@$lines as $key => $line)
@php 

 $total = $line->billed_to_date + $line->work_completed + $line->stored_to_date +  $line->materials_stored;

 $retainage =  $line->project_line->retainage;
 $percentage = number_format($total/ $line->project_line->value*100, 1);
 $retainage_value =  ($total * $retainage/100);
 $exclude_retainage =  $line->project_line->value - (float) $total;

 $dTotal = $dTotal + $line->billed_to_date;
 $eTotal = $eTotal + $line->work_completed;
 $fTotal = $fTotal + $line->materials_stored + $line->stored_to_date;
 $gTotal = $gTotal + $total;
 $hTotal = $hTotal + $exclude_retainage;
 $iTotal = $iTotal + $retainage_value;


 if($line->materials_stored > 0){
   $nmTotal = $nmTotal + $line->materials_stored;
}
else
{
  $pbTotal = $pbTotal + $line->materials_stored;
}

$less_retainage = ($eTotal + $pbTotal + $nmTotal) * $retainage/100;

@endphp
<TR>
  <TD class="lb tr1 td4"><P class="p5 ft7">{{ $key + 1}}</P></TD>
  <TD class="tr1 td5"><P class="p6 ft7">{{ $line->project_line->description }}
  </P>
   
   @if($line->materials_stored)
       <p class="p23 ft9">
       <br> <span class='star'>*</span>

       @if($line->materials_stored < 0)
       ${{ \App\Models\Payment::format(abs($line->materials_stored)) }}
       materials used, previously billed
       @else
        ${{ \App\Models\Payment::format($line->materials_stored) }}
       new materials stored
       @endif

       </p>
   @endif
 
</TD>
  <TD class="tr1 td6"><P class="p5 ft7">${{ \App\Models\Payment::format($line->project_line->value) }}</P></TD>
  <TD class="tr1 td7"><P class="p15 ft7">${{ \App\Models\Payment::format($line->billed_to_date) }}</P></TD>
  <TD class="tr1 td8"><P class="p16 ft7">{!! ($line->work_completed) ? '<span class="star">*</span>' : '' !!}${{ \App\Models\Payment::format($line->work_completed) }}</P></TD>
  <TD class="tr1 td9"><P class="p16 ft7">{!! ($line->materials_stored) ? '<span class="star">*</span>' : '' !!} ${{ ($line->materials_stored > 0 ) ? \App\Models\Payment::format($line->materials_stored + $line->stored_to_date) : \App\Models\Payment::format(0.00) }}</P></TD>
  <TD class="tr1 td10"><P class="p17 ft7">${{ \App\Models\Payment::format($total) }}</P></TD>
  <TD class="tr1 td11"><P class="p14 ft8">{{ $percentage  }}%</P></TD>
  <TD class="tr1 td10"><P class="p15 ft7">${{ $exclude_retainage }}</P></TD>
  <TD class="tr1 td12"><P class="p11 ft7">${{ \App\Models\Payment::format($retainage_value) }}</P></TD>
</TR>
@endforeach

<TR>
  <TD class="lb bb brn tr1 td4 tr-grey"><P class="p2 ft6">&nbsp;</P></TD>
  <TD class="bb tr1 td5 tr-grey"><P class="p20 ft15">TOTALS</P></TD>
  <TD class="bb tr1 td6 tr-grey"><P class="p5 ft7">${{ \App\Models\Payment::format(@$project->original_amount ) }}</P></TD>
  <TD class="bb tr1 td7 tr-grey"><P class="p15 ft7">${{ \App\Models\Payment::format($dTotal) }}</P></TD>
  <TD class="bb tr1 td8 tr-grey"><P class="p8 ft7">${{\App\Models\Payment::format($eTotal)}}</P></TD>
  <TD class="bb tr1 td9 tr-grey"><P class="p16 ft7">${{ ($fTotal > 0) ?  \App\Models\Payment::format($fTotal) : \App\Models\Payment::format(0)}}</P></TD>
  <TD class="bb tr1 td10 tr-grey"><P class="p17 ft7">${{\App\Models\Payment::format($gTotal)}}</P></TD>
  <TD class="bb tr1 td11 tr-grey"><P class="p14 ft8">{{ number_format(($gTotal/ @$project->original_amount*100), 1) }}%</P></TD>
  <TD class="bb tr1 td10 tr-grey"><P class="p7 ft7">${{\App\Models\Payment::format($hTotal)}}</P></TD>
  <TD class="tr1 td12 tr-grey"><P class="p11 ft7 pbb"><span>${{\App\Models\Payment::format($iTotal)}}</span></P></TD>
</TR>

@if($changeOrdersTotal > 0)


@php

  $changeOrderApplications = $project->changeOrderApplications()
                            ->where('app','<=',$applicationsCount)->get();  
                                
  $totalCO = 0;
  
  foreach (@$changeOrderApplications as $ck => $changeOrder) {

       $coTotal = $changeOrder->value;
       $coRetainage = $changeOrder->retainage;

       $changeOrderlines = $changeOrder->application_lines()
                            ->where('app_no',$applicationsCount)->get(); 

       $coseTotal = $cosnmTotal = $cospbTotal = 0 ;              

       foreach (@$changeOrderlines as $k => $cLine) {

                $totalCO = $cLine->billed_to_date + $cLine->work_completed + (($cLine->materials_stored > 0) ? $cLine->materials_stored : 0) ;

                $co_retainage_value   =  ($totalCO * $coRetainage/100);

                $co_exclude_retainage =  $coTotal - (float) $totalCO;
       
                $codTotal = $codTotal + $cLine['billed_to_date'];
                $coeTotal = $coeTotal + $cLine['work_completed'];                
                $coseTotal = $coseTotal + $cLine['work_completed'];                
                $cofTotal = $cofTotal + $cLine['materials_stored'] + $cLine->stored_to_date;                
                $cogTotal = $cogTotal + $totalCO;                
                $cohTotal = $cohTotal + $co_exclude_retainage;                
                $coiTotal = $coiTotal + $co_retainage_value; 

                 if($cLine->materials_stored > 0){
                     $conmTotal = $conmTotal + $cLine->materials_stored;
                     $cosnmTotal = $cosnmTotal + $cLine->materials_stored;
                  }
                  else
                  {
                    $copbTotal = $copbTotal + $cLine->materials_stored;
                    $cospbTotal = $cospbTotal + $cLine->materials_stored;
                  }

        }

        if($changeOrderlines->count() > 0){
         $co_less_retainage = $co_less_retainage + (($coseTotal + $cosnmTotal + $cospbTotal) * $coRetainage/100);
        }
         
  }

@endphp
<TR>
  <TD class="tr15 td4"><P class="p2 ft13">&nbsp;</P></TD>
  <TD class="tr15 td5"><P class="p2 ft13">&nbsp;</P></TD>
  <TD class="tr15 td6"><P class="p2 ft13">&nbsp;</P></TD>
  <TD class="tr15 td8"><P class="p2 ft13">&nbsp;</P></TD>
  <TD class="tr15 td9"><P class="p2 ft13">&nbsp;</P></TD>
  <TD class="tr15 td10"><P class="p2 ft13">&nbsp;</P></TD>
  <TD class="tr15 td11"><P class="p2 ft13">&nbsp;</P></TD>
  <TD class="tr15 td10"><P class="p2 ft13">&nbsp;</P></TD>
  <TD class="tr15 td12"><P class="p2 ft13">&nbsp;</P></TD>
</TR>

<TR>
  <TD class="lb bub tr12 td4 tr-grey"><P class="p2 ft6">&nbsp;</P></TD>
  <TD class="lr bub tr12 td5 tr-grey"><P class="p20 ft15">TOTAL CHANGE ORDERS</P></TD>
  <TD class="lr bub tr12 td6 tr-grey"><P class="p5 ft7">${{ \App\Models\Payment::format(@$changeOrdersTotal) }}</P></TD>
  <TD class="lr bub tr12 td7 tr-grey"><P class="p15 ft7">
  ${{ \App\Models\Payment::format($codTotal) }}</P></TD>
  <TD class="lr bub  tr12 td8 tr-grey"><P class="p8 ft7">${{ \App\Models\Payment::format(@$coeTotal) }}</P></TD>
  <TD class="lr bub tr12 td9 tr-grey"><P class="p16 ft7">${{ \App\Models\Payment::format(@$cofTotal) }}</P></TD>
  <TD class="lr bub tr12 td10 tr-grey"><P class="p17 ft7">${{ \App\Models\Payment::format(@$cogTotal) }}</P></TD>
  <TD class="lr bub tr12 td11 tr-grey"><P class="p14 ft8">{{
   number_format((@$cogTotal) / $changeOrdersTotal * 100,1)
  }}%</P></TD>
  <TD class="lr bub tr12 td10 tr-grey"><P class="p7 ft7">${{ \App\Models\Payment::format(@$cohTotal) }}</P></TD>
  <TD class="lr bub tr12 td12 tr-grey"><P class="p11 ft7 pbb2"><span>${{ \App\Models\Payment::format(@$coiTotal) }}</span></P></TD>
</TR>

<TR>
  <TD class="tr15 td4"><P class="p2 ft13">&nbsp;</P></TD>
  <TD class="tr15 td5"><P class="p2 ft13">&nbsp;</P></TD>
  <TD class="tr15 td6"><P class="p2 ft13">&nbsp;</P></TD>
  <TD class="tr15 td8"><P class="p2 ft13">&nbsp;</P></TD>
  <TD class="tr15 td9"><P class="p2 ft13">&nbsp;</P></TD>
  <TD class="tr15 td10"><P class="p2 ft13">&nbsp;</P></TD>
  <TD class="tr15 td11"><P class="p2 ft13">&nbsp;</P></TD>
  <TD class="tr15 td10"><P class="p2 ft13">&nbsp;</P></TD>
  <TD class="tr15 td12"><P class="p2 ft13">&nbsp;</P></TD>
</TR>


<TR>
  <TD class="blrn bb tr13 td4 tr-grey"><P class="p2 ft6">&nbsp;</P></TD>
  <TD class="bb tr13 td5 tr-grey"><P class="p20 ft15">GRAND TOTALS</P></TD>
  <TD class="bb tr13 td6 tr-grey"><P class="p5 ft7">${{ \App\Models\Payment::format( @$project->original_amount + $changeOrdersTotal)  }}</P></TD>
  <TD class="bb tr13 td7 tr-grey"><P class="p15 ft7">${{ \App\Models\Payment::format(@$codTotal + $dTotal) }}</P></TD>
  <TD class="bb tr13 td8 tr-grey"><P class="p8 ft7">${{ \App\Models\Payment::format(@$coeTotal + $eTotal) }}</P></TD>
  <TD class="bb tr13 td9 tr-grey"><P class="p16 ft7">${{ \App\Models\Payment::format(@$cofTotal + $fTotal) }}</P></TD>
  <TD class="bb tr13 td10 tr-grey"><P class="p17 ft7">${{ \App\Models\Payment::format(@$cogTotal + $gTotal) }}</P></TD>
  <TD class="bb tr13 td11 tr-grey"><P class="p14 ft8">{{
   number_format((@$cogTotal + $gTotal) / (@$project->original_amount + $changeOrdersTotal) * 100,1)
  }}%</P></TD>
  <TD class="bb tr13 td10 tr-grey"><P class="p7 ft7">${{ \App\Models\Payment::format(@$cohTotal + $hTotal) }}</P></TD>
  <TD class="bb tr13 td12 tr-grey"><P class="p11 ft7">${{ \App\Models\Payment::format(@$coiTotal + $iTotal) }}</P></TD>
</TR>

@endif

</TABLE>

@if($nmTotal || $pbTotal || $conmTotal || $copbTotal)
<TABLE cellpadding=0 cellspacing=0 class="t4">
<TR>
  <TD class="tr18"><P class="p24 ft23">Materials Stored Summary</P></TD>
  <TD class="tr18 td30"><P class="p0 ft0">&nbsp;</P></TD>
  <TD class="tr18 td31"><P class="p0 ft0">&nbsp;</P></TD>
</TR>
<TR>
  <TD colspan=2  class="lb tr19 td4"><P class="p6 ft21">Work Completed This Period</P></TD>
 
  <TD class="tr19 td31"><P class="p32 ft21">${{ \App\Models\Payment::format($eTotal + $coeTotal) }}</P></TD>
</TR>


@if($nmTotal || $conmTotal)
<TR>
  <TD colspan=2  class="lb tr20 td4"><P class="p6 ft9">
      
          New Materials Stored this Period
       
  </P></TD>
  
  <TD class="tr20 td31"><P class="p32 ft9">
        ${{ \App\Models\Payment::format($nmTotal + $conmTotal ) }}
</P></TD>
</TR>
@endif

@if($pbTotal || $copbTotal)
<TR>
  <TD colspan=2  class="lb tr20 td4"><P class="p6 ft9">
         Less Material Used, Previously Billed
  </P></TD>
  
  <TD class="tr20 td31"><P class="p32 ft9">
 
         -${{ \App\Models\Payment::format(abs($pbTotal) + abs($copbTotal)) }}
       
</P></TD>
</TR>
@endif

<TR>
  <TD colspan=2 class="lb tr19 td33"><P class="p6 ft9">Total Earned This Period Including Retainage</P></TD>
  <TD class="tr19 td31"><P class="p32 ft9">${{ \App\Models\Payment::format($eTotal + $coeTotal + $nmTotal + $conmTotal + $pbTotal + $copbTotal) }}</P></TD>
</TR>
<TR>
  <TD colspan=2  class="lb tr20 td4"><P class="p6 ft9">Less Retainage</P></TD>

  <TD class="tr20 td31"><P class="p32 ft9"><NOBR>-${{ \App\Models\Payment::format($less_retainage + $co_less_retainage) }} </NOBR></P></TD>
</TR>
<TR>
  <TD colspan=2  class="lb tr19 td4 bb"><P class="p6 ft21">Current Payment Due</P></TD>

  <TD class="tr19 td31 bb"><P class="p32 ft21">${{ \App\Models\Payment::format($eTotal + $coeTotal + $nmTotal + $conmTotal + $pbTotal + $copbTotal - $less_retainage - $co_less_retainage) }}</P></TD>
</TR>
</TABLE>
@endif

</DIV>

</DIV>
</DIV>


</BODY>
</HTML>
